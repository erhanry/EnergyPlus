# üìå MongoDB_v4.0.28 –†–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å Docker Compose

## üìñ –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

- [üìù –û–ø–∏—Å–∞–Ω–∏–µ](#-–æ–ø–∏—Å–∞–Ω–∏–µ)
- [üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏](#-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏)
- [üîÑ –õ–æ–≥–∏–∫–∞ –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞](#-–ª–æ–≥–∏–∫–∞-–Ω–∞-—Ä–µ–ø–ª–∏–∫–∞-—Å–µ—Ç–∞)
- [üöÄ –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ-–Ω–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [‚ùå –°–ø–∏—Ä–∞–Ω–µ –∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ](#-—Å–ø–∏—Ä–∞–Ω–µ-–∏-–∏–∑—Ç—Ä–∏–≤–∞–Ω–µ-–Ω–∞-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ)
- [üé® –î–∏–∑–∞–π–Ω –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞](#-–¥–∏–∑–∞–π–Ω-–Ω–∞-—Å–∏—Å—Ç–µ–º–∞—Ç–∞)
- [üõ† –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏](#-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏)
- [üìÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –º—Ä–µ–∂–∞—Ç–∞](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–Ω–∞-–º—Ä–µ–∂–∞—Ç–∞)
- [üì¨ –ü–æ–ª–µ–∑–Ω–∏ –∫–æ–º–∞–Ω–¥–∏](#-–ø–æ–ª–µ–∑–Ω–∏-–∫–æ–º–∞–Ω–¥–∏)
- [üìú –õ–∏—Ü–µ–Ω–∑](#-–ª–∏—Ü–µ–Ω–∑)
- [üì¨ –ö–æ–Ω—Ç–∞–∫—Ç–∏](#-–∫–æ–Ω—Ç–∞–∫—Ç–∏)

## üìù –û–ø–∏—Å–∞–Ω–∏–µ

–¢–æ–∑–∏ –ø—Ä–æ–µ–∫—Ç –∏–∑–ø–æ–ª–∑–≤–∞ **Docker Compose** –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ MongoDB Replica Set —Å **–ø—ä—Ä–≤–∏—á–µ–Ω** (Primary), **–≤—Ç–æ—Ä–∏—á–µ–Ω** (Secondary) –∏ **–∞—Ä–±–∏—Ç—ä—Ä** (Arbiter) –≤—ä–∑–µ–ª. –¢–æ–≤–∞ –æ—Å–∏–≥—É—Ä—è–≤–∞ **—Ä–µ–∑–µ—Ä–≤–∏—Ä–∞–Ω–æ—Å—Ç** –∏ **–≤–∏—Å–æ–∫–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç** –Ω–∞ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏.

## üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä       | –†–æ–ª—è                                        | –ü–æ—Ä—Ç(–æ–≤–µ) | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                 |
| --------------- | ------------------------------------------- | --------- | ---------------------------------------------------------------------------------------- |
| mongo-primary   | –û—Å–Ω–æ–≤–µ–Ω –Ω–æ–¥ –∑–∞ –∑–∞–ø–∏—Å–∏—Ç–µ                     | 27017     | –ì–µ–Ω–µ—Ä–∏—Ä–∞ keyfile –∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ mongod —Å —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.                           |
| mongo-secondary | –í—Ç–æ—Ä–∏—á–µ–Ω –Ω–æ–¥, –∫–æ–π—Ç–æ —Ä–µ–ø–ª–∏–∫–∏—Ä–∞ –¥–∞–Ω–Ω–∏         | 27018     | –°—Ç–∞—Ä—Ç–∏—Ä–∞ mongod –Ω–∞ –ø–æ—Ä—Ç 27018 —Å –ø–æ-–Ω–∏—Å—ä–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.                                      |
| mongo-arbiter   | –ê—Ä–±–∏—Ç—ä—Ä –∑–∞ –∏–∑–±–æ—Ä–∏ (–±–µ–∑ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω–∏) | 27019     | –°—Ç–∞—Ä—Ç–∏—Ä–∞ mongod –∫–∞—Ç–æ –∞—Ä–±–∏—Ç—ä—Ä (arbiterOnly: true).                                        |
| mongo-setup     | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è                  | -         | –ò–∑—á–∞–∫–≤–∞ –¥–∞ –µ –≥–æ—Ç–æ–≤ mongo-primary –∏ –∏–∑–ø—ä–ª–Ω—è–≤–∞ –∫–æ–º–∞–Ω–¥–∞—Ç–∞ –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞. |

## üîÑ –õ–æ–≥–∏–∫–∞ –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞

### üìå –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—ä—Ä–≤–∏—á–Ω–∏—è –Ω–æ–¥:

- `mongo-primary` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ä—Ç —Å–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞, –≥–µ–Ω–µ—Ä–∏—Ä–∞ `keyfile` –∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ MongoDB —Å—ä—Å –∑–∞–¥–∞–¥–µ–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç.

### üìå –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Ç–æ—Ä–∏—á–Ω–∏—è –∏ –∞—Ä–±–∏—Ç—ä—Ä –Ω–æ–¥–æ–≤–µ—Ç–µ:

- `mongo-secondary` –∏ `mongo-arbiter` —Å–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç –Ω–∞ —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—Ç–µ —Å–∏ –ø–æ—Ä—Ç–æ–≤–µ, –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ —Å—ä—â–∏—è `keyfile` –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.

### ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:

- `mongo-setup` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ä—Ç –∏–∑—á–∞–∫–≤–∞ –æ–∫–æ–ª–æ **20 —Å–µ–∫—É–Ω–¥–∏**, –∑–∞ –¥–∞ —Å–µ —É–≤–µ—Ä–∏, —á–µ –ø—ä—Ä–≤–∏—á–Ω–∏—è—Ç –Ω–æ–¥ –µ –≥–æ—Ç–æ–≤.
- –°–ª–µ–¥ —Ç–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–æ—Å—Ç—ä–ø–Ω–æ—Å—Ç—Ç–∞ —á—Ä–µ–∑ `ping`.
- –ù–∞–∫—Ä–∞—è –∏–∑–ø—ä–ª–Ω—è–≤–∞ –∫–æ–º–∞–Ω–¥–∞—Ç–∞ –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞:

```javascript
rs.initiate({
  _id: "<MONGO_REPLICA_SET>",
  members: [
    { _id: 0, host: "mongo-primary:27017", priority: 1 },
    { _id: 1, host: "mongo-secondary:27018", priority: 0.7 },
    { _id: 2, host: "mongo-arbiter:27019", arbiterOnly: true }
  ]
})
```

üöÄ –¢–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## üöÄ –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞

1. **–ö–ª–æ–Ω–∏—Ä–∞–Ω–µ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—Ç–æ** *(–∞–∫–æ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)*:

   ```sh
   git clone <URL-–ù–ê-–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
   cd <–ò–ú–ï-–ù–ê-–ü–†–û–ï–ö–¢–ê>
   ```

2. **–°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ**:

   ```sh
   docker-compose build --no-cache
   docker-compose up -d
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–±–æ—Ç–µ—â–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏**:

   ```sh
   docker ps
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ MongoDB Replica Set**:

   ```sh
   docker exec -it mongo_primary mongo --eval 'rs.status()'
   rs.config()
   db.version()
   ```

## ‚ùå –°–ø–∏—Ä–∞–Ω–µ –∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ

–ó–∞ –¥–∞ **—Å–ø—Ä–µ—Ç–µ** –≤—Å–∏—á–∫–∏ —Ä–∞–±–æ—Ç–µ—â–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏:

```sh
docker-compose down
```

–ó–∞ –¥–∞ **–∏–∑—Ç—Ä–∏–µ—Ç–µ –≤—Å–∏—á–∫–∏ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏ –¥–∞–Ω–Ω–∏, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, –º—Ä–µ–∂–∞ –∏ –∏–º–∏–¥–∂**:

```sh
docker volume rm mongo_primary mongo_secondary mongo_arbiter mongo_keyfile mongo_setup
docker rm -f mongo_primary mongo_secondary mongo_arbiter mongo_keyfile mongo_setup
docker network rm energy
docker rmi -f erhanbg/mongodb:4.0.28
```

## üé® –î–∏–∑–∞–π–Ω –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

MongoDB Replica Set —Å–µ —Å—ä—Å—Ç–æ–∏ –æ—Ç **—Ç—Ä–∏ –≤—ä–∑–µ–ª–∞**, –∫–æ–µ—Ç–æ –æ—Å–∏–≥—É—Ä—è–≤–∞ **—Ä–µ–∑–µ—Ä–≤–∏—Ä–∞–Ω–æ—Å—Ç** –∏ **—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç**:

- **–û—Å–Ω–æ–≤–µ–Ω –≤—ä–∑–µ–ª (Primary)** - –û–±—Ä–∞–±–æ—Ç–≤–∞ –≤—Å–∏—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –∑–∞–ø–∏—Å.
- **–í—Ç–æ—Ä–∏—á–µ–Ω –≤—ä–∑–µ–ª (Secondary)** - –†–µ–ø–ª–∏–∫–∏—Ä–∞ –¥–∞–Ω–Ω–∏—Ç–µ –∏ –º–æ–∂–µ –¥–∞ —Å—Ç–∞–Ω–µ Primary –ø—Ä–∏ –Ω—É–∂–¥–∞.
- **–ê—Ä–±–∏—Ç—ä—Ä (Arbiter)** - –£—á–∞—Å—Ç–≤–∞ –≤ –∏–∑–±–æ—Ä–∏—Ç–µ –∑–∞ –Ω–æ–≤ Primary, –Ω–æ –Ω–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –¥–∞–Ω–Ω–∏.

üõ° *–¢–∞–∑–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Å–∏–≥—É—Ä—è–≤–∞ –∑–∞—â–∏—Ç–∞ —Å—Ä–µ—â—É –æ—Ç–∫–∞–∑–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–∏—è —Å—ä—Ä–≤—ä—Ä.*

## üõ† –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏

- **–°–∏–≥—É—Ä–Ω–æ—Å—Ç üîí**: –ò–∑–ø–æ–ª–∑–≤–∞ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω `keyfile` –∑–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –Ω–æ–¥–æ–≤–µ—Ç–µ.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ü§ñ**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ä—Ç `mongo-setup` –∏–∑—á–∞–∫–≤–∞ –¥–∞ –µ –≥–æ—Ç–æ–≤ –ø—ä—Ä–≤–∏—á–Ω–∏—è—Ç –Ω–æ–¥ –∏ —Å–ª–µ–¥ —Ç–æ–≤–∞ –∏–∑–ø—ä–ª–Ω—è–≤–∞ –∫–æ–º–∞–Ω–¥–∞—Ç–∞ –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ —Å–µ—Ç–∞.
- **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω–∏ üíæ**: Docker volume-–∏—Ç–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞—Ç, —á–µ –¥–∞–Ω–Ω–∏—Ç–µ –Ω–µ —Å–µ –≥—É–±—è—Ç –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ.
- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ –º—Ä–µ–∂–∞ üåê**: –í—Å–∏—á–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ —Å–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ –∫—ä–º —Å–ø–µ—Ü–∏–∞–ª–Ω–æ —Å—ä–∑–¥–∞–¥–µ–Ω–∞ –º—Ä–µ–∂–∞ `energy` —Å –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω –ø–æ–¥—Å–µ—Ç.
- **–õ–µ—Å–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∏ –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ üßπ**: –Ø—Å–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ –±–∏–ª–¥, —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –∏ –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è—Ç–∞.

## üìÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –º—Ä–µ–∂–∞—Ç–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—Ç—è—Ç –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∞ –º—Ä–µ–∂–∞ —Å **bridge** –¥—Ä–∞–π–≤–µ—Ä –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–∞ –ø–æ–¥–º—Ä–µ–∂–∞ `172.10.5.0/24`.

## üì¨ –ü–æ–ª–µ–∑–Ω–∏ –∫–æ–º–∞–Ω–¥–∏

üîπ **–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–æ—Ç–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –æ—Ç Docker:**

```sh
docker system df -v
```

üîπ **–ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –Ω–µ–∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏ –±–∏–ª–¥–æ–≤–µ:**

```sh
docker builder prune -a --force
```

üîπ **–í–ª–∏–∑–∞–Ω–µ –≤ MongoDB CLI:**

```sh
docker exec -it mongo_primary mongo
```

üîπ **–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ª–æ–≥–æ–≤–µ—Ç–µ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**

```sh
docker logs mongo_primary
```

üîπ **–†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**

```sh
docker restart mongo_primary
```

## üìú –õ–∏—Ü–µ–Ω–∑

–¢–æ–∑–∏ –ø—Ä–æ–µ–∫—Ç –µ —Å –æ—Ç–≤–æ—Ä–µ–Ω –∫–æ–¥ –∏ –µ –¥–æ—Å—Ç—ä–ø–µ–Ω –ø–æ–¥ **MIT License**.

## üì¨ –ö–æ–Ω—Ç–∞–∫—Ç–∏

–ó–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –º–æ–ª—è —Å–≤—ä—Ä–∂–µ—Ç–µ —Å–µ –Ω–∞ **erhan.ysuf @ gmail.com**.

üìÖ **–ü–æ—Å–ª–µ–¥–Ω–æ –æ–±–Ω–æ–≤–µ–Ω–æ:** 2025-03-22
